- name: install config center
  hosts: configcenter
  sudo: True
  tasks:
    - name: install docker
      shell: sudo yum -y install docker-io
    - name: copy image
      copy: src=/tmp/configcenter.tar dest=/tmp/configcenter.tar owner=root group=root mode=777
    - name: start docker service
      shell: systemctl start docker
    - name: stop container
      shell: docker stop ConfigCenter
      ignore_errors: yes
    - name: remove container
      shell: docker rm ConfigCenter
      ignore_errors: yes
    - name: remove image
      shell: docker rmi dockerloud/configcenter
      ignore_errors: yes
    - name: load image
      shell: docker load < /tmp/configcenter.tar
    - name: build and start container
      shell: docker run  --name ConfigCenter -p 1111:1111 dockerloud/configcenter &
    - name: sleep 5s
      shell: sleep 5s
      ignore_errors: yes
    - name: sleep 5s
      shell: docker start ConfigCenter
      ignore_errors: yes